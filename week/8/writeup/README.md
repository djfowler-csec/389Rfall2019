# Writeup 8 - Binaries II

Name: *PUT YOUR NAME HERE*
Section: *PUT YOUR SECTION NUMBER HERE*

I pledge on my honor that I have not given or received any unauthorized assistance on this assignment or examination.

Digital acknowledgement: *PUT YOUR NAME HERE*

## Assignment Writeup

### Part 1 (100 pts)
Answer the following questions regarding the server executable (for which source is provided).

1. How is the per-session administrator password generated? Are there any inherent weaknesses in this implementation?
	The password is randomly generated by utilizing a random function based on the system time. Although generally this would make the password unpredictable, in reality it doesn't make sense to have a password you can't remember because most people would resort to writing it down, I don't believe this is what you're looking for. The password is generated with a pointer. This pointer points to the address of the heap and therefore we know the address of the password and can use that to our advantage later.

2. Describe two vulnerabilities in this program. Provide specific line numbers and classifications of the vulnerability. Explain potential ramifications as well as ways to avoid these vulnerabilities when writing code.
	The first vulnerability I discovered was the 'gets()' function within the elevate command on line 68. This allowed me to do a bufferoverflow which I'll go more in depth on in number 4. You can easily avoid this by using the safer 'fgets' function because in this case you can pass a pre-determined buffer size which would prevent this type of attackin this case.
	The second vulnerability after searching around thoroughly is the 'printf(output)' in the cipher function on line 46. Without utilizing expected string formatting when calling the printf method you're able to pass through string formatting  into the function itself and it doesn't know any better but to process the string formatting in this case we exploit this vulnerability to find the password along the stack and generally speaking will cause the function to behave unpredictably. You can avoid this my password more arguments into the printf function to prevent this or use a different function altogether. I believe the 'puts' function would have behaved properly as that function only prints the string as is, not falling victim to a string formatting being passed through.
 
3. What is the flag?
	Here is the discovered flag: CMSC389R-{expl017-2-w1n}
 
4. Describe the process you followed to obtain the flag: vulnerabilities exploited, your inputs to the server in a human-readable format, etc. If you create any helper code please include it.
	At first I thoroughly examined the source code provided and fiddled around in gdb for awhile. I started to play around with string formatting within the printf function and couldn't easily find a way to reach the password. My next step was to try and find where on the stack the password actually was and compare that to the printf function so I know how far to go when scanning the stack for the password. I found the address of the password through gdb (p &password) and also found the general location of the printf function by adding a variable to the stack right before the printf call. This got me the general location of the printf call on the stack relative to the password, after doing some hexadecimal math and dividing that by 4 (32 bit program means that theres about 4bytes allocated to each 'layer' of the stack) and got 29. That was the offset between printf and the password, 29. I provided the printf with the formatted string '%29$s' which gracefully provided the password. This was definetly the hardest part. I took the password to elevate my privileges so I could access the exec_command function. After getting into the exec_function I basically brute forced the buffer overflow. I started with an arbitrary amount of a's until i found the right amount to where the command would be changed to my desired command. At first i got it down to 'grep 389                             grep 389' then discovered the arbitrary amount of whitespace would be an issue. Luckily thats easy enough to balance out so then i tried 'grep 389                       grep 389                          ' which worked! However the grep command itself didn't work. After that it was the homestretch, next I did something similar but with ls. 'ls                                  ls                           ' provided me with bin,dev,flag,lib,lib32,lib64, etc. so essentially i found the flag file but I needed to extract the flag so I provided the server with a simple 'cat flag                           cat flag                            '.
*NOTE* The whitespace i provided in this README within the commands is not the exact amount i provided the server, its just to give you an idea of how I completed this part using the buffer overflow

*Ignore* nc ec2-18-222-89-163.us-east-2.compute.amazonaws.com 1337

